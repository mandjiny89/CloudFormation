---
#This YAML file is to modify the user profile in BOTP landscape. 

- hosts: server2
  remote_user: root
  become: yes
  gather_facts: yes
  vars: 
    user_password: "$6$ansible$IwSzE2RB6pzfc2byyIu48zaAvIvKcw9Y8bTsRaFkULlU0I5eV3w5zzGX5NfPSgO/lMmToxL/0YbaPaxUU9LaJ0"

  tasks:
    - name: Add the new users for CommVault
      user:
        name: backup_user
        create_home: yes
        shell: /bin/bash
        local: no
        state: present
        update_password: on_create
        password: "{{user_password}}"
      register: user_creation
    - debug: 
        msg: "{{user_creation}}"
        
    - name: Giving sudo permissions
      lineinfile:
        path: "/etc/sudoers"
        state: absent
        line: "backup_user	ALL=(ALL)	ALL"  
        
    - name: This is to ask user to change the password at login
      shell: "{{item}}"
      with_items:
        - creates="/home/backup_user" chage -d 0 backup_user
      when: user_creation.changed == true
